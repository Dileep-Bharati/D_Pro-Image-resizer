<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Image Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        html { scroll-behavior: smooth; }
        body { background-color: var(--bs-tertiary-bg); }
        .upload-area { border: 2px dashed #0d6efd; border-radius: 10px; padding: 4rem; text-align: center; cursor: pointer; background-color: var(--bs-body-bg); transition: background-color 0.2s; min-height: 280px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .upload-area:hover { background-color: var(--bs-secondary-bg); }
        .options-card { background-color: var(--bs-body-bg); border-radius: 10px; padding: 2rem; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .feature-icon { font-size: 3rem; color: #0d6efd; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/">Pro Image Tool</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#main-nav"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="main-nav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Resize</a>
                        <ul class="dropdown-menu"><li><a class="dropdown-item" href="/?tool=resizer">Image Resizer</a></li><li><a class="dropdown-item" href="/bulk-resize">Bulk Resize</a></li><li><hr class="dropdown-divider"></li><li><a class="dropdown-item" href="/?tool=resizer&format=png">Resize PNG</a></li><li><a class="dropdown-item" href="/?tool=resizer&format=jpeg">Resize JPG</a></li><li><a class="dropdown-item" href="/?tool=resizer&format=webp">Resize WebP</a></li></ul>
                    </li>
                    <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Crop</a>
                        <ul class="dropdown-menu"><li><a class="dropdown-item" href="/crop">Crop Image</a></li><li><hr class="dropdown-divider"></li><li><a class="dropdown-item" href="/crop">Crop PNG</a></li><li><a class="dropdown-item" href="/crop">Crop JPG</a></li><li><a class="dropdown-item" href="/crop">Crop WebP</a></li></ul>
                    </li>
                    <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Compress</a>
                        <ul class="dropdown-menu"><li><a class="dropdown-item" href="/?tool=compressor">Image Compressor</a></li><li><hr class="dropdown-divider"></li><li><a class="dropdown-item" href="/?tool=compressor">Compress PNG</a></li><li><a class="dropdown-item" href="/?tool=compressor">Compress JPG</a></li></ul>
                    </li>
                    <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Convert</a>
                        <ul class="dropdown-menu"><li><a class="dropdown-item" href="/convert">Image Converter</a></li><li><hr class="dropdown-divider"></li><li><a class="dropdown-item" href="/convert?output=jpeg">PNG to JPG</a></li><li><a class="dropdown-item" href="/convert?output=png">JPG to PNG</a></li><li><a class="dropdown-item" href="/convert?output=jpeg">WebP to JPG</a></li></ul>
                    </li>
                    <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">More</a>
                        <ul class="dropdown-menu"><li><a class="dropdown-item" href="/meme">Meme Generator</a></li><li><a class="dropdown-item" href="/color-picker">Color Picker</a></li><li><hr class="dropdown-divider"></li><li><a class="dropdown-item" href="/transform">Rotate Image</a></li><li><a class="dropdown-item" href="/transform">Flip Image</a></li><li><a class="dropdown-item" href="#">Image Enlarger</a></li></ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container mt-5">
        <div class="row g-4">
            <div class="col-lg-7"><div class="upload-area" id="uploadArea"><h3>Select or Drag & Drop Image Here</h3><p class="text-muted">File will be processed instantly</p><button class="btn btn-primary mt-3">Select Image</button></div></div>
            <div class="col-lg-5">
                <div id="alertPlaceholder"></div>
                <div class="options-card">
                    <input type="file" id="masterFileInput" class="d-none" accept="image/*">
                    <ul class="nav nav-tabs nav-fill mb-4" id="myTab" role="tablist">
                        <li class="nav-item" role="presentation"><button class="nav-link {% if active_tool == 'resizer' %}active{% endif %}" id="dimension-tab" data-bs-toggle="tab" data-bs-target="#dimension-pane" type="button" role="tab">Resize by Dimension</button></li>
                        <li class="nav-item" role="presentation"><button class="nav-link {% if active_tool == 'compressor' %}active{% endif %}" id="filesize-tab" data-bs-toggle="tab" data-bs-target="#filesize-pane" type="button" role="tab">Reduce File Size</button></li>
                    </ul>
                    <div class="tab-content" id="myTabContent">
                        <div class="tab-pane fade {% if active_tool == 'resizer' %}show active{% endif %}" id="dimension-pane" role="tabpanel">
                            <form id="dimensionForm" method="post" enctype="multipart/form-data"><input type="hidden" name="mode" value="dimension"><input type="file" name="image" class="dimension-file-input d-none"><div class="input-group mb-3"><select class="form-select" name="unit" id="unitSelector" style="max-width: 120px;"><option value="px">Pixels</option><option value="cm">cm</option><option value="mm">mm</option></select><input type="number" class="form-control" name="width" placeholder="Width" required step="any"><input type="number" class="form-control" name="height" placeholder="Height" required step="any"></div><div id="dpi_input" class="mb-3" style="display:none;"><label for="dpi" class="form-label">DPI</label><input type="number" name="dpi" class="form-control" value="96"></div><div class="mb-3"><label for="transform" class="form-label">Transform</label><select name="transform" class="form-select"><option value="none">None</option><option value="rotate_90">Rotate 90° Clockwise</option><option value="rotate_180">Rotate 180°</option><option value="rotate_270">Rotate 270°</option><option value="flip_horizontal">Flip Horizontal</option><option value="flip_vertical">Flip Vertical</option></select></div><div class="row g-2 mb-3"><div class="col"><label for="format" class="form-label">Format</label><select name="format" id="formatSelector" class="form-select"><option value="jpeg">JPEG</option><option value="png">PNG</option><option value="webp">WEBP</option></select></div><div class="col" id="quality_input"><label for="quality" class="form-label">Quality: <span id="qualityValue">85</span></label><input type="range" name="quality" class="form-range" min="1" max="100" value="85" id="qualitySlider"></div></div><div class="form-check mb-4"><input class="form-check-input" type="checkbox" name="aspect_ratio" value="true" id="aspectRatioCheck" checked><label class="form-check-label" for="aspectRatioCheck">Maintain Aspect Ratio</label></div><div class="d-grid"><button type="submit" class="btn btn-success btn-lg">Resize and Download</button></div></form>
                        </div>
                        <div class="tab-pane fade {% if active_tool == 'compressor' %}show active{% endif %}" id="filesize-pane" role="tabpanel">
                            <form id="filesizeForm" method="post" enctype="multipart/form-data"><input type="hidden" name="mode" value="filesize"><input type="file" name="image" class="filesize-file-input d-none"><p class="text-muted small">The tool will automatically reduce image quality to meet your target size. Most effective for JPEG/WEBP.</p><div class="input-group mb-4"><input type="number" class="form-control" name="target_size" placeholder="e.g., 100" required><select class="form-select" name="size_unit" style="max-width: 100px;"><option value="KB">KB</option><option value="MB">MB</option></select></div><div class="d-grid"><button type="submit" class="btn btn-success btn-lg">Reduce and Download</button></div></form>
                        </div>
                    </div>
                    <!-- NEW RESET BUTTON -->
                    <div class="d-grid mt-3">
                        <button type="button" id="resetButton" class="btn btn-outline-danger">Reset</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="features" class="container my-5 py-5"><h2 class="text-center mb-5">Why Choose Our Tool?</h2><div class="row text-center g-4"><div class="col-md-4"><i class="bi bi-gem feature-icon mb-3"></i><h4>Flexible Controls</h4><p>Resize images by pixels, cm, mm, or let our tool automatically compress your image to a target file size in KB or MB.</p></div><div class="col-md-4"><i class="bi bi-lightning-charge-fill feature-icon mb-3"></i><h4>Lightning Fast</h4><p>All processing happens instantly in your browser and on our powerful cloud backend. No waiting around.</p></div><div class="col-md-4"><i class="bi bi-lightbulb-fill feature-icon mb-3"></i><h4>Easy To Use</h4><p>Simply drag and drop your image, choose your options, and download. It's designed to be simple and intuitive.</p></div><div class="col-md-4"><i class="bi bi-images feature-icon mb-3"></i><h4>Multiple Formats</h4><p>Convert your images to the most popular web formats, including JPEG, PNG, and the modern WEBP for superior compression.</p></div><div class="col-md-4"><i class="bi bi-shield-check feature-icon mb-3"></i><h4>Privacy Guaranteed</h4><p>Your images are uploaded via a secure connection and are automatically processed without manual checks. Your privacy is respected.</p></div><div class="col-md-4"><i class="bi bi-patch-check-fill feature-icon mb-3"></i><h4>It's Free</h4><p>Our powerful image processing tool is completely free to use. No watermarks, no sign-ups, no hassle.</p></div></div></div>
    <div id="how-it-works" class="bg-body py-5"><div class="container"><h2 class="text-center mb-5">How It Works in 3 Simple Steps</h2><div class="row align-items-center"><div class="col-md-6 text-center"><i class="bi bi-image" style="font-size: 6rem; color: #6c757d;"></i><i class="bi bi-arrow-right mx-3" style="font-size: 3rem; color: #6c757d;"></i><i class="bi bi-aspect-ratio" style="font-size: 6rem; color: #0d6efd;"></i></div><div class="col-md-6"><ol class="list-group list-group-numbered"><li class="list-group-item border-0 fs-5"><b>Select an Image:</b> Drag and drop your image onto the upload area, or click to select a file from your device.</li><li class="list-group-item border-0 fs-5"><b>Choose Your Options:</b> Select a tab. Either enter your desired dimensions (like 100x100 pixels) or a target file size (like 200 KB).</li><li class="list-group-item border-0 fs-5"><b>Download:</b> Click the "Resize and Download" button. Your new image will be ready instantly.</li></ol></div></div></div></div>
    <footer class="mt-5 py-4 border-top bg-body-tertiary"><div class="container d-flex flex-wrap justify-content-between align-items-center"><div class="col-md-5 text-center text-md-start mb-2 mb-md-0"><p class="mb-0 text-muted">&copy; <span id="currentYear"></span> Pro Image Tool v.1.0.0. All rights reserved.</p></div><div class="col-md-7 d-flex justify-content-center justify-content-md-end align-items-center"><ul class="nav"><li class="nav-item"><a href="#" class="nav-link px-2 text-muted">About Us</a></li><li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Privacy</a></li><li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Terms of Use</a></li></ul><div class="dropdown"><button class="btn btn-link nav-link px-2 text-muted dropdown-toggle" type="button" id="bd-theme" data-bs-toggle="dropdown" aria-expanded="false"><svg class="bi my-1 theme-icon-active" width="16" height="16" fill="currentColor"><use href="#circle-half"></use></svg><span id="bd-theme-text" class="d-none d-lg-inline">Theme</span></button><ul class="dropdown-menu dropdown-menu-end"><li><button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light"><svg class="bi me-2 opacity-50 theme-icon" width="16" height="16" fill="currentColor"><use href="#sun-fill"></use></svg>Light</button></li><li><button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark"><svg class="bi me-2 opacity-50 theme-icon" width="16" height="16" fill="currentColor"><use href="#moon-stars-fill"></use></svg>Dark</button></li><li><button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="auto"><svg class="bi me-2 opacity-50 theme-icon" width="16" height="16" fill="currentColor"><use href="#circle-half"></use></svg>System</button></li></ul></div><ul class="nav"><li class="nav-item"><a href="#" class="nav-link ps-2 text-muted"><i class="bi bi-globe me-1"></i> English</a></li></ul></div></div></footer>
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162h1.234a.217.217 0 0 1 .153.372l-.998.95c-.05.047-.072.121-.053.184l.393 1.157a.217.217 0 0 1-.328.245l-1.013-.746a.217.217 0 0 0-.254 0l-1.013.746a.217.217 0 0 1-.328-.245l.393-1.157a.217.217 0 0 0-.053-.184l-.998-.95a.217.217 0 0 1 .153-.372h1.234l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258c-.346.115-.617.386-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a.752.752 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774.258c.346-.115.617.386.732.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707z"/></symbol></svg>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
    <script>
        const activeFormat = "{{ active_format or '' }}";
        document.addEventListener('DOMContentLoaded', function() { if (activeFormat) { const formatSelector = document.getElementById('formatSelector'); if (formatSelector) { formatSelector.value = activeFormat; formatSelector.disabled = true; formatSelector.dispatchEvent(new Event('change')); } } });
        const unitSelector = document.getElementById('unitSelector');
        const dpiInput = document.getElementById('dpi_input');
        const formatSelector = document.getElementById('formatSelector');
        const qualityInput = document.getElementById('quality_input');
        const qualitySlider = document.getElementById('qualitySlider');
        const qualityValue = document.getElementById('qualityValue');
        unitSelector.addEventListener('change', () => { dpiInput.style.display = (unitSelector.value === 'cm' || unitSelector.value === 'mm') ? 'block' : 'none'; });
        formatSelector.addEventListener('change', () => { qualityInput.style.display = (formatSelector.value === 'jpeg' || formatSelector.value === 'webp') ? 'block' : 'none'; });
        qualitySlider.addEventListener('input', () => { qualityValue.textContent = qualitySlider.value; });
        const uploadArea = document.getElementById('uploadArea');
        const masterFileInput = document.getElementById('masterFileInput');
        const dimensionFileInput = document.querySelector('.dimension-file-input');
        const filesizeFileInput = document.querySelector('.filesize-file-input');
        const alertPlaceholder = document.getElementById('alertPlaceholder');
        const showAlert = (message, type = 'danger') => { alertPlaceholder.innerHTML = `<div class="alert alert-${type} alert-dismissible" role="alert"><div>${message}</div><button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>`; };
        function handleFile(file) { if (file && file.type.startsWith('image/')) { alertPlaceholder.innerHTML = ''; const dataTransfer = new DataTransfer(); dataTransfer.items.add(file); dimensionFileInput.files = dataTransfer.files; filesizeFileInput.files = dataTransfer.files; const reader = new FileReader(); reader.onload = function(e) { uploadArea.innerHTML = ''; const img = document.createElement('img'); img.src = e.target.result; img.style.maxWidth = '100%'; img.style.maxHeight = '280px'; img.style.objectFit = 'contain'; uploadArea.appendChild(img); }; reader.readAsDataURL(file); } else { showAlert('Please select a valid image file.'); } }
        uploadArea.addEventListener('click', () => masterFileInput.click());
        masterFileInput.addEventListener('change', () => { if (masterFileInput.files.length) handleFile(masterFileInput.files[0]); });
        uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.style.borderColor = '#28a745'; });
        uploadArea.addEventListener('dragleave', (e) => { e.preventDefault(); uploadArea.style.borderColor = '#0d6efd'; });
        uploadArea.addEventListener('drop', (e) => { e.preventDefault(); uploadArea.style.borderColor = '#0d6efd'; if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]); });
        const dimensionForm = document.getElementById('dimensionForm');
        const filesizeForm = document.getElementById('filesizeForm');
        const resetButton = document.getElementById('resetButton');

        resetButton.addEventListener('click', () => {
            masterFileInput.value = '';
            dimensionFileInput.value = '';
            filesizeFileInput.value = '';
            dimensionForm.reset();
            filesizeForm.reset();
            uploadArea.innerHTML = '<h3>Select or Drag & Drop Image Here</h3><p class="text-muted">File will be processed instantly</p><button class="btn btn-primary mt-3">Select Image</button>';
            alertPlaceholder.innerHTML = '';
            if (formatSelector.disabled) { formatSelector.disabled = false; }
            formatSelector.dispatchEvent(new Event('change'));
        });

        async function handleFormSubmit(event) {
            event.preventDefault();
            alertPlaceholder.innerHTML = '';
            const form = event.target;
            const submitButton = form.querySelector('button[type="submit"]');
            const originalButtonText = submitButton.innerHTML;
            if (masterFileInput.files.length === 0) { showAlert('Please select an image first.'); return; }
            submitButton.disabled = true;
            submitButton.innerHTML = `<span class="spinner-border spinner-border-sm"></span> Processing...`;
            try {
                const formData = new FormData(form);
                const response = await fetch('/process', { method: 'POST', body: formData });
                const result = await response.json();
                if (response.ok && result.success) {
                    const link = document.createElement('a');
                    link.href = result.download_url;
                    link.download = result.download_url.split('/').pop();
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } else { showAlert(result.error || 'Something went wrong.'); }
            } catch (error) { console.error('Submission error:', error); showAlert('A network error occurred.');
            } finally { submitButton.disabled = false; submitButton.innerHTML = originalButtonText; }
        }
        dimensionForm.addEventListener('submit', handleFormSubmit);
        filesizeForm.addEventListener('submit', handleFormSubmit);
    </script>
</body>
</html>